<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumus - Quiz Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=General+Sans:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'General Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-image: url('./images/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        body.quiz-active {
            display: block;
        }

        .container {
            max-width: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 120px;
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            min-height: auto;
            margin: 0 auto;
            padding: 40px;
        }

        body.quiz-active .container {
            display: none;
        }

        /* Landing Page Styles */
        .landing-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-align: center;
            background: transparent;
            padding-top: 80px;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-family: "General Sans";
            font-size: 2.25rem;
            font-style: normal;
            font-weight: 600;
            line-height: normal;
            color: #FFF;
            margin-bottom: 0;
            background: none;
            background-clip: unset;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
        }

        .tagline {
            color: #FFDBCB;
            text-align: center;
            font-family: "General Sans";
            font-size: 1.125rem;
            font-style: normal;
            font-weight: 500;
            line-height: normal;
            margin-bottom: 0;
            white-space: nowrap;
        }

        .search-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            margin-bottom: 0;
            margin-top: 110px;
        }

        .search-container {
            background: #fdfdfd;
            border-radius: 12px;
            height: 84px;
            width: 100%;
            padding: 12px;
            display: flex;
          
            justify-content: space-between;
            box-sizing: border-box;
        }

        .search-input {
            flex: 1;
            border: none;
            background: transparent;
            font-family: 'General Sans', sans-serif;
            font-size: 14px;
            color: #71717a;
            outline: none;
            padding: 0;
            align-self: flex-start;
            resize: none;
            min-height: 60px;
            max-height: 60px;
            overflow-y: auto;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .search-input:focus {
            color: #000;
        }

        .search-input::placeholder {
            color: #71717a;
        }

        .generate-btn {
            background: #fdfdfd;
            border: 0.75px solid #e4e4e7;
            border-radius: 4px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
            position: static;
            transform: none;
        }

        .generate-btn:hover {
            background: #f4f4f5;
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .recommendations {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
            margin-top: 8px;
        }

        .recommendations h3 {
            color: #000;
            text-align: center;
            font-family: "General Sans", sans-serif;
            font-size: 18px;
            font-style: normal;
            font-weight: 500;
            line-height: 24px;
            margin-bottom: 0;
        }

        .topic-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }

        .topic-card {
            display: flex;
            padding: var(--spacing-xs, 6px) 14px;
            justify-content: center;
            align-items: center;
            gap: 4px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.90);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            border: none;
        }

        .topic-card:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .topic-card:hover .topic-title {
            color: #000;
        }

        .topic-card:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .topic-card:active .topic-title {
            color: #000;
        }

        .topic-icon {
            display: none;
        }

        .topic-title {
            color: #71717a;
            text-align: center;
            font-family: "General Sans", sans-serif;
            font-size: var(--Font-size-text-sm, 14px);
            font-style: normal;
            font-weight: 500;
            line-height: var(--Line-height-text-sm, 20px);
            margin-bottom: 0;
        }

        .topic-desc {
            display: none;
        }

        /* Quiz Page Styles */
        .quiz-page {
            display: none;
            min-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 32px 24px;
            background: rgba(0, 0, 0, 0.1);
            min-height: 100vh;
        }

        .quiz-page.show {
            display: block;
        }

        /* Quiz Header */
        .quiz-header {
            text-align: center;
            margin-bottom: 48px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-title {
            color: #FFF;
            font-family: "General Sans";
            font-size: 36px;
            font-style: normal;
            font-weight: 600;
            line-height: normal;
            margin-bottom: 8px;
        }

        .quiz-meta {
            color: #FFDBCB;
            text-align: center;
            font-family: "General Sans";
            font-size: 18px;
            font-style: normal;
            font-weight: 500;
            line-height: normal;
            margin-bottom: 40px;
        }


        /* Progress Bar */
        .progress-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 24px;
            margin-top: 24px;
        }

        .progress-segment {
            min-width: 4px;
            height: 4px;
            width: 56px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease-in-out;
            position: relative;
        }

        .progress-segment.current {
            background: #FFF;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }

        .progress-segment.correct {
            background: #90EE90;
        }

        .progress-segment.incorrect {
            background: #FF6B6B;
        }

        .progress-segment:hover {
            transform: scale(1.1);
        }

        /* Responsive Design for Progress Segments */
        @media (max-width: 768px) {
            .progress-container {
                gap: 8px;
            }
            
            .progress-segment {
                width: 3px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            .progress-container {
                gap: 6px;
            }
            
            .progress-segment {
                width: 3px;
                height: 36px;
            }
        }

        /* Question Container */
        .question-container {
            display: flex;
            width: 800px;
            padding: 24px;
            flex-direction: column;
            align-items: flex-start;
            gap: 0px;
            background: rgba(255, 255, 255, 0.70);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            margin: 0 auto 12px auto;
        }

        .question-number {
            font-family: "General Sans", sans-serif;
            font-size: 0.875rem;
            color: #52525B;
            font-weight: 600;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-text {
            color: #000;
            font-family: Inter;
            font-size: 24px;
            font-style: normal;
            font-weight: 400;
            line-height: 20px; /* 142.857% */
            margin-bottom: 40px;
        }

        /* Options Container */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }

        .option {
            background: #FFF;
        
            border-radius: 16px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            transition: width 0.3s ease;
        }

        .option:hover {
            border-color: #374151;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .option:hover::before {
            width: 100%;
        }

        .option.selected {
            border-color: #374151;
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .option.correct {
            border-color: #10B981;
            background: linear-gradient(135deg, #ECFDF5 0%, #F0FDF4 100%);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
        }

        .option.incorrect {
            border-color: #EF4444;
            background: linear-gradient(135deg, #FEF2F2 0%, #FEF7F7 100%);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.2);
        }

        .option-letter {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "General Sans", sans-serif;
            font-weight: 700;
            font-size: 1rem;
            color: #6B7280;
            background: #F3F4F6;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option:hover .option-letter {
            background: #374151;
            color: #FFF;
        }

        .option.selected .option-letter {
            background: #374151;
            color: #FFF;
        }

        .option.correct .option-letter {
            background: #10B981;
            color: #FFF;
        }

        .option.incorrect .option-letter {
            background: #EF4444;
            color: #FFF;
        }

        .option-text {
            flex: 1;
            font-family: "General Sans", sans-serif;
            font-size: 1rem;
            font-weight: 500;
            color: #374151;
            line-height: 1.5;
        }

        /* Feedback */
        .feedback {
            width: 800px;
            margin: 8px auto 0 auto;
            padding: 12px 24px;
            border-radius: 16px;
            display: none;
            backdrop-filter: blur(20px);
            font-family: "General Sans", sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
        }

        .feedback.correct {
            background: linear-gradient(135deg, rgb(202, 255, 237) 0%, rgb(202, 255, 237) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: #065F46;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, rgb(255, 207, 207) 0%,  rgb(255, 207, 207) 100%);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #991B1B;
        }

        .feedback-icon {
            font-size: 1.5rem;
            margin-right: 12px;
        }

        .explanation {
            margin-top: 16px;
            font-family: "General Sans", sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1.6;
            opacity: 0.9;
        }

        /* Next Button */
        .next-btn-container {
            text-align: center;
            margin-top: 32px;
            display: block;
            visibility: visible;
        }

        .next-btn {
            background: #FFF;
            color: #000;
            border: none;
            padding: 16px 48px;
            border-radius: 16px;
            font-family: "General Sans", sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            display: inline-block;
            visibility: visible;
            opacity: 1;
            position: relative;
            z-index: 10;
            width: 200px;
            min-width: 200px;
            max-width: 200px;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            
            background: #F9FAFB;
        }

        .next-btn:active {
            transform: translateY(0);
        }

        .next-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: #F3F4F6;
            color: #9CA3AF;
        }

        .next-btn.loading {
            position: relative;
            overflow: hidden;
            width: 200px;
            min-width: 200px;
            max-width: 200px;
        }

        .next-btn.loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: #ffffff;
            animation: progressBar 2s linear forwards;
            z-index: 1;
        }

        .next-btn.loading span {
            position: relative;
            z-index: 2;
        }

        @keyframes progressBar {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Results Page */
        .results-page {
            display: none;
            padding: 40px;
            text-align: center;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            color: rgba(0, 0, 0, 0.505);
            font-size: 3rem;
            font-weight: bold;
        }

        .score-text {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 40px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #FFF;
            border: none;
            color: #000;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .action-btn:hover {
            background: #F9FAFB;
            color: #000;
            border-color: #D1D5DB;
        }

        .action-btn.primary {
            background: #FFF;
            color: #000;
            border: none;
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.40);
            backdrop-filter: blur(8px);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading.show {
            display: flex;
            opacity: 1;
        }

        .loading-animation {
            width: 80px;
            height: 80px;
            margin-bottom: 40px;
            position: relative;
        }

        .loading-circle {
            width: 100%;
            height: 100%;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #333;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: #333;
            font-family: "General Sans", sans-serif;
            text-align: center;
            font-weight: 500;
            letter-spacing: 0.5px;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes textPulse {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .landing-page {
                padding: 40px 20px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .search-input {
                padding: 15px 20px;
                font-size: 1rem;
            }
            
            .generate-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .topic-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .question-container {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Landing Page -->
        <div class="landing-page" id="landingPage">
            <div class="logo-container">
                <svg width="40" height="28" viewBox="0 0 53 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_120_21)">
                        <path d="M27.9246 9.78719C28.698 10.4624 29.2773 11.8092 29.5335 12.8004C29.6704 13.3304 29.8284 15.693 30.4743 15.5783C31.3894 14.737 31.7627 13.3983 32.3618 12.3089C35.114 7.3006 40.1212 -0.629583 46.7419 0.039749C50.4899 0.418881 52.0112 4.66071 52.2019 7.91961C52.6711 15.9457 47.0555 29.66 40.065 34.0575C33.5624 38.1484 29.5792 35.5506 28.5611 28.4009C28.4827 27.8486 28.581 26.1823 28.0919 25.9448C27.5583 25.685 27.3184 26.1601 27.0586 26.5509C25.1408 29.4436 23.6371 32.3783 20.7117 34.4799C16.9988 37.1479 13.3479 35.959 12.4632 31.393C12.3556 30.8372 12.3532 27.7691 11.1199 28.8678C10.8039 29.1487 10.1522 30.4768 9.81749 30.9577C8.08214 33.4467 3.4916 38.6668 0.848209 34.233C-1.82795 29.7443 2.36006 20.3818 6.03085 17.2247C8.36649 15.2167 11.7471 14.4561 12.8845 18.1C13.0975 18.7834 12.9758 20.2239 13.851 20.1373C14.1728 20.0425 15.7549 16.8643 16.1071 16.3003C17.7477 13.6651 21.2312 9.2419 24.5241 8.9201C25.8487 8.79021 26.9077 8.89904 27.9246 9.78836V9.78719Z" fill="white"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_120_21">
                            <rect width="52.2301" height="36" fill="white"/>
                        </clipPath>
                    </defs>
                </svg>
                <div class="logo">Lumus</div>
            </div>
            <div class="tagline">Type a topic. Get a quiz. Learn something new.</div>
            
            <div class="search-section">
                <div class="search-container">
                    <textarea class="search-input" id="topicInput" placeholder="Type any topic. Example: World War II" rows="1"></textarea>
                    <button class="generate-btn" id="generateBtn">
                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="0.525" y="0.525" width="26.95" height="26.95" rx="5.075" fill="#FDFDFD"/>
                            <rect x="0.525" y="0.525" width="26.95" height="26.95" rx="5.075" stroke="#E4E4E7" stroke-width="1.05"/>
                            <path d="M14.0004 19.7167V8.28336M14.0004 8.28336L8.28369 14M14.0004 8.28336L19.717 14" stroke="#52525B" stroke-width="1.63333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                
                <div class="recommendations">
                    <div class="topic-grid">
                        <div class="topic-card" onclick="selectTopic('Photosynthesis')">
                            <div class="topic-title">Photosynthesis</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('AI Agents')">
                            <div class="topic-title">AI Agents</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('Github')">
                            <div class="topic-title">Github</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('Sports Psychology')">
                            <div class="topic-title">Sports Psychology</div>
                        </div>
                        <div class="topic-card" onclick="selectTopic('Breaking Bad')">
                            <div class="topic-title">Breaking Bad</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Page -->
        <div class="loading" id="loadingPage">
            <div class="loading-animation">
                <div class="loading-circle"></div>
            </div>
            <div class="loading-text">Building the quiz</div>
        </div>
    </div>

    <!-- Quiz Page -->
    <div class="quiz-page" id="quizPage">
            <div class="quiz-header">
                <div class="quiz-title" id="quizTitle">Quiz Title</div>
                <div class="quiz-meta" id="quizMeta">10 Questions • Medium Difficulty</div>
                <div class="progress-container" id="progressContainer">
                    <!-- Progress segments will be generated here -->
                </div>
            </div>
            
            <div class="question-container" id="questionContainer">
                <!-- Question content will be populated here -->
            </div>
            
            <div class="feedback" id="feedback">
                <!-- Feedback will be shown here -->
            </div>
            
            <div class="next-btn-container">
                <button class="next-btn" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div class="results-page" id="resultsPage">
            <div class="score-circle" id="scoreCircle">0/10</div>
            <div class="score-text" id="scoreText">Great job! You completed the quiz!</div>
            
            <div class="action-buttons">
                <button class="action-btn primary" onclick="startNewQuiz()">Try Another Topic</button>
                <button class="action-btn" onclick="retakeQuiz()">Retake This Quiz</button>
            </div>
        </div>

    <script>
        // Global variables
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;

        // Sample quiz data for demo
        const sampleQuizzes = {
            'Photosynthesis': {
                title: 'Photosynthesis Quiz',
                total_questions: 10,
                questions: [
                    {
                        question: 'What is the main pigment involved in photosynthesis?',
                        type: 'multiple-choice',
                        options: ['Chlorophyll', 'Carotene', 'Xanthophyll', 'Anthocyanin'],
                        answer: 'Chlorophyll',
                        explanation: 'Chlorophyll is the primary pigment that captures light energy for photosynthesis.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'In which organelle does photosynthesis occur?',
                        type: 'multiple-choice',
                        options: ['Mitochondria', 'Chloroplast', 'Nucleus', 'Ribosome'],
                        answer: 'Chloroplast',
                        explanation: 'Chloroplasts contain the thylakoids where photosynthesis takes place.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'What are the two main stages of photosynthesis?',
                        type: 'multiple-choice',
                        options: ['Light-dependent reactions and Calvin cycle', 'Glycolysis and Krebs cycle', 'Photosystem I and II', 'Chlorophyll and Carotene'],
                        answer: 'Light-dependent reactions and Calvin cycle',
                        explanation: 'The light-dependent reactions capture energy, while the Calvin cycle uses it to make glucose.',
                        difficulty: 'medium'
                    },
                    {
                        question: 'True or False: Photosynthesis only occurs in green plants.',
                        type: 'true-false',
                        answer: 'False',
                        explanation: 'Photosynthesis also occurs in algae, cyanobacteria, and some other photosynthetic organisms.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'What is the overall equation for photosynthesis?',
                        type: 'multiple-choice',
                        options: ['6CO2 + 6H2O + light energy → C6H12O6 + 6O2', 'C6H12O6 + 6O2 → 6CO2 + 6H2O + energy', '6H2O + light energy → 3O2 + 6H+', 'CO2 + H2O → CH2O + O2'],
                        answer: '6CO2 + 6H2O + light energy → C6H12O6 + 6O2',
                        explanation: 'This equation shows how carbon dioxide and water are converted to glucose and oxygen using light energy.',
                        difficulty: 'medium'
                    },
                    {
                        question: 'Which wavelength of light is most effectively absorbed by chlorophyll?',
                        type: 'multiple-choice',
                        options: ['Green', 'Red and Blue', 'Yellow', 'All wavelengths equally'],
                        answer: 'Red and Blue',
                        explanation: 'Chlorophyll absorbs red and blue light most effectively, which is why plants appear green.',
                        difficulty: 'medium'
                    },
                    {
                        question: 'True or False: The Calvin cycle requires light to function.',
                        type: 'true-false',
                        answer: 'False',
                        explanation: 'The Calvin cycle is light-independent and uses ATP and NADPH produced in the light-dependent reactions.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'What gas is released as a byproduct of photosynthesis?',
                        type: 'multiple-choice',
                        options: ['Carbon dioxide', 'Oxygen', 'Nitrogen', 'Water vapor'],
                        answer: 'Oxygen',
                        explanation: 'Oxygen is released as a byproduct when water molecules are split during the light-dependent reactions.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'What is the primary function of the thylakoid membranes?',
                        type: 'multiple-choice',
                        options: ['To house the light-dependent reactions and electron transport chain', 'To store glucose molecules', 'To transport water throughout the plant', 'To protect the nucleus'],
                        answer: 'To house the light-dependent reactions and electron transport chain',
                        explanation: 'Thylakoid membranes contain chlorophyll and other pigments that capture light energy.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'True or False: Photosynthesis occurs only during the day.',
                        type: 'true-false',
                        answer: 'True',
                        explanation: 'Photosynthesis requires light energy, so it only occurs during daylight hours.',
                        difficulty: 'easy'
                    }
                ]
            },
            'Machine Learning': {
                title: 'Machine Learning Quiz',
                total_questions: 10,
                questions: [
                    {
                        question: 'What is machine learning?',
                        type: 'multiple-choice',
                        options: ['A type of computer hardware', 'A subset of artificial intelligence', 'A programming language', 'A database system'],
                        answer: 'A subset of artificial intelligence',
                        explanation: 'Machine learning is a subset of AI that focuses on algorithms that can learn from data.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'True or False: Supervised learning uses labeled training data.',
                        type: 'true-false',
                        answer: 'True',
                        explanation: 'Supervised learning requires labeled data to train models to make predictions.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'What are the three main types of machine learning?',
                        type: 'multiple-choice',
                        options: ['Supervised, Unsupervised, and Reinforcement Learning', 'Deep, Shallow, and Medium Learning', 'Linear, Non-linear, and Hybrid Learning', 'Classification, Regression, and Clustering'],
                        answer: 'Supervised, Unsupervised, and Reinforcement Learning',
                        explanation: 'These are the three primary categories of machine learning approaches.',
                        difficulty: 'medium'
                    },
                    {
                        question: 'Which algorithm is commonly used for classification problems?',
                        type: 'multiple-choice',
                        options: ['Linear Regression', 'Decision Trees', 'K-means', 'All of the above'],
                        answer: 'Decision Trees',
                        explanation: 'Decision trees are specifically designed for classification problems.',
                        difficulty: 'medium'
                    },
                    {
                        question: 'True or False: Deep learning is a subset of machine learning.',
                        type: 'true-false',
                        answer: 'True',
                        explanation: 'Deep learning uses neural networks with multiple layers and is a subset of machine learning.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'What is overfitting in machine learning?',
                        type: 'multiple-choice',
                        options: ['When a model performs well on training data but poorly on new data', 'When a model is too simple to capture patterns', 'When a model takes too long to train', 'When a model uses too much memory'],
                        answer: 'When a model performs well on training data but poorly on new data',
                        explanation: 'Overfitting occurs when a model memorizes training data instead of learning general patterns.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'Which technique helps prevent overfitting?',
                        type: 'multiple-choice',
                        options: ['Adding more data', 'Regularization', 'Cross-validation', 'All of the above'],
                        answer: 'All of the above',
                        explanation: 'All these techniques can help prevent overfitting in machine learning models.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'True or False: Unsupervised learning finds hidden patterns in data without labels.',
                        type: 'true-false',
                        answer: 'True',
                        explanation: 'Unsupervised learning discovers patterns in data without using labeled examples.',
                        difficulty: 'easy'
                    },
                    {
                        question: 'What is the purpose of feature engineering?',
                        type: 'multiple-choice',
                        options: ['To create or select the most relevant input variables for the model', 'To reduce the size of the dataset', 'To speed up model training', 'To visualize data patterns'],
                        answer: 'To create or select the most relevant input variables for the model',
                        explanation: 'Feature engineering improves model performance by providing better input data.',
                        difficulty: 'hard'
                    },
                    {
                        question: 'Which machine learning algorithm is inspired by biological neural networks?',
                        type: 'multiple-choice',
                        options: ['Support Vector Machine', 'Neural Networks', 'Random Forest', 'K-Nearest Neighbors'],
                        answer: 'Neural Networks',
                        explanation: 'Neural networks are inspired by the structure and function of biological neurons.',
                        difficulty: 'medium'
                    }
                ]
            }
        };

        function selectTopic(topic) {
            document.getElementById('topicInput').value = topic;
            generateQuiz();
        }

        function updateProgressSegments() {
            const container = document.getElementById('progressContainer');
            container.innerHTML = '';
            
            // Safety check for quiz data
            if (!currentQuiz || !currentQuiz.total_questions) {
                console.error('Quiz data not available for progress segments');
                return;
            }
            
            for (let i = 0; i < currentQuiz.total_questions; i++) {
                const segment = document.createElement('div');
                segment.className = 'progress-segment';
                
                if (i === currentQuestionIndex) {
                    segment.classList.add('current');
                } else if (i < currentQuestionIndex) {
                    // Check if the question was answered correctly
                    if (currentQuiz.questions[i].userAnswer === currentQuiz.questions[i].answer) {
                        segment.classList.add('correct');
                    } else {
                        segment.classList.add('incorrect');
                    }
                }
                
                container.appendChild(segment);
            }
        }

        async function generateQuiz() {
            const topic = document.getElementById('topicInput').value.trim();
            
            if (!topic) {
                alert('Please enter a topic or select one from the recommendations!');
                return;
            }

            // Show loading page with smooth transition
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('quizPage').classList.remove('show');
            document.body.classList.remove('quiz-active');
            document.getElementById('resultsPage').style.display = 'none';
            
            // Trigger smooth black screen transition
            const loadingPage = document.getElementById('loadingPage');
            loadingPage.style.display = 'flex';
            setTimeout(() => {
                loadingPage.classList.add('show');
            }, 10);

            // Start timing for minimum loading duration
            const startTime = Date.now();
            const minLoadingTime = 1000; // 1 second minimum

            try {
                // Determine API endpoint based on environment
                const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
                const apiUrl = isProduction 
                    ? 'https://lumus-taupe.vercel.app/api/generate-quiz'  // Production API
                    : 'http://localhost:8080/generate-quiz';  // Local development
                
                // Try to get quiz from server first
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        api_key: 'AIzaSyBaWa_oPFgBou2dneLGAMQs6aBwVh0eQUE',
                        topic: topic,
                        num_questions: 10
                    })
                });

                if (response.ok) {
                    currentQuiz = await response.json();
                    console.log('✅ Generated quiz using enhanced AI + web search');
                } else {
                    throw new Error('API call failed');
                }
            } catch (error) {
                console.log('⚠️ Using fallback quiz data');
                // Fallback to sample data
                currentQuiz = sampleQuizzes[topic] || createGenericQuiz(topic);
            }

            // Ensure minimum loading time
            const elapsedTime = Date.now() - startTime;
            const remainingTime = Math.max(0, minLoadingTime - elapsedTime);
            
            if (remainingTime > 0) {
                await new Promise(resolve => setTimeout(resolve, remainingTime));
            }
            
            // Reset quiz state
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;

            // Hide loading page with smooth transition
            loadingPage.classList.remove('show');
            setTimeout(() => {
                loadingPage.style.display = 'none';
                // Show quiz page
                document.getElementById('quizPage').classList.add('show');
                document.body.classList.add('quiz-active');
            }, 500);
            
            // Safety check before showing quiz
            if (!currentQuiz || !currentQuiz.questions || currentQuiz.questions.length === 0) {
                console.error('Quiz data is invalid:', currentQuiz);
                alert('Failed to load quiz data. Please try again.');
                return;
            }
            
            // Update quiz header
            document.getElementById('quizTitle').textContent = currentQuiz.title.replace(' Quiz', '');
            document.getElementById('quizMeta').textContent = `${currentQuiz.total_questions} Questions • Medium Difficulty`;
            
            // Show first question
            showQuestion();
        }

        function createGenericQuiz(topic) {
            return {
                title: `${topic} Quiz`,
                total_questions: 10,
                questions: [
                    {
                        question: `What is ${topic}?`,
                        type: 'multiple-choice',
                        options: [`A field of study related to ${topic}`, `A type of technology`, `A historical event`, `A scientific concept`],
                        answer: `A field of study related to ${topic}`,
                        explanation: `This is a general question about ${topic}.`,
                        difficulty: 'easy'
                    },
                    {
                        question: `True or False: ${topic} is an important subject.`,
                        type: 'true-false',
                        answer: 'True',
                        explanation: `${topic} is indeed an important subject worth studying.`,
                        difficulty: 'easy'
                    },
                    {
                        question: `Which of the following best describes ${topic}?`,
                        type: 'multiple-choice',
                        options: ['A complex subject', 'A simple concept', 'A practical skill', 'An abstract idea'],
                        answer: 'A complex subject',
                        explanation: `${topic} typically involves multiple aspects and concepts.`,
                        difficulty: 'medium'
                    },
                    {
                        question: `True or False: ${topic} requires specialized knowledge.`,
                        type: 'true-false',
                        answer: 'True',
                        explanation: `Most topics require some level of specialized knowledge to understand fully.`,
                        difficulty: 'easy'
                    },
                    {
                        question: `What is the main focus of ${topic}?`,
                        type: 'multiple-choice',
                        options: ['Understanding core concepts', 'Memorizing facts', 'Practical application', 'All of the above'],
                        answer: 'All of the above',
                        explanation: `${topic} typically involves understanding, memorization, and application.`,
                        difficulty: 'medium'
                    }
                ]
            };
        }

        function showQuestion() {
            // Safety check for quiz data
            if (!currentQuiz || !currentQuiz.questions || !currentQuiz.questions[currentQuestionIndex]) {
                console.error('Quiz data not available:', { currentQuiz, currentQuestionIndex });
                return;
            }
            
            const question = currentQuiz.questions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            // Update progress segments
            updateProgressSegments();
            
            let html = `
                <div class="question-text">${question.question}</div>
            `;

            if (question.type === 'multiple-choice') {
                html += '<div class="options-container">';
                question.options.forEach((option, index) => {
                    html += `
                        <div class="option" onclick="selectOption(${index})">
                            <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                });
                html += '</div>';
            } else if (question.type === 'true-false') {
                html += `
                    <div class="options-container">
                        <div class="option" onclick="selectOption(0)">
                            <div class="option-letter">T</div>
                            <div class="option-text">True</div>
                        </div>
                        <div class="option" onclick="selectOption(1)">
                            <div class="option-letter">F</div>
                            <div class="option-text">False</div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
            
            // Hide feedback and disable next button
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').disabled = true;
        }

        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[index].classList.add('selected');
            
            const question = currentQuiz.questions[currentQuestionIndex];
            let userAnswer;
            
            if (question.type === 'multiple-choice') {
                userAnswer = question.options[index];
            } else if (question.type === 'true-false') {
                userAnswer = index === 0 ? 'True' : 'False';
            }
            
            // Store user answer in the question object for progress tracking
            question.userAnswer = userAnswer;
            userAnswers[currentQuestionIndex] = userAnswer;
            checkAnswer(userAnswer);
        }

        function checkAnswer(userAnswer) {
            const question = currentQuiz.questions[currentQuestionIndex];
            const correctAnswer = question.answer;
            const isCorrect = userAnswer.toLowerCase().trim() === correctAnswer.toLowerCase().trim();
            
            if (isCorrect) {
                score++;
            }
            
            showFeedback(isCorrect, correctAnswer, question.explanation);
            
            if (isCorrect) {
                // Auto-advance for correct answers with loading effect
                const nextBtn = document.getElementById('nextBtn');
                const nextBtnContainer = document.querySelector('.next-btn-container');
                
                // Ensure container and button are visible
                if (nextBtnContainer) {
                    nextBtnContainer.style.display = 'block';
                    nextBtnContainer.style.visibility = 'visible';
                }
                
                nextBtn.innerHTML = '<span>Next</span>';
                nextBtn.classList.add('loading');
                nextBtn.disabled = false;
                nextBtn.style.display = 'inline-block';
                nextBtn.style.visibility = 'visible';
                nextBtn.style.opacity = '1';
                
                // Auto-advance after 2 seconds
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            } else {
                // Manual advance for incorrect answers
                const nextBtn = document.getElementById('nextBtn');
                const nextBtnContainer = document.querySelector('.next-btn-container');
                
                if (nextBtnContainer) {
                    nextBtnContainer.style.display = 'block';
                    nextBtnContainer.style.visibility = 'visible';
                }
                
                nextBtn.disabled = false;
                nextBtn.style.display = 'inline-block';
                nextBtn.style.visibility = 'visible';
                nextBtn.style.opacity = '1';
            }
        }

        function showFeedback(isCorrect, correctAnswer, explanation) {
            const feedback = document.getElementById('feedback');
            const message = isCorrect ? 'Correct!' : `Incorrect. The correct answer is: ${correctAnswer}`;
            
            feedback.innerHTML = `<div>${message}</div>`;
            
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            // Highlight correct/incorrect options
            const options = document.querySelectorAll('.option');
            const question = currentQuiz.questions[currentQuestionIndex];
            
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none';
                
                if (question.type === 'multiple-choice') {
                    if (question.options[index] === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected') && question.options[index] !== correctAnswer) {
                        option.classList.add('incorrect');
                    }
                } else if (question.type === 'true-false') {
                    const optionValue = index === 0 ? 'True' : 'False';
                    if (optionValue === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected') && optionValue !== correctAnswer) {
                        option.classList.add('incorrect');
                    }
                }
            });
        }

        function nextQuestion() {
            // Safety check for quiz data
            if (!currentQuiz || !currentQuiz.total_questions) {
                console.error('Quiz data not available for nextQuestion');
                return;
            }
            
            // Reset button state
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.innerHTML = 'Next';
            nextBtn.classList.remove('loading');
            nextBtn.disabled = true;
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex < currentQuiz.total_questions) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quizPage').classList.remove('show');
            document.body.classList.remove('quiz-active');
            document.getElementById('resultsPage').style.display = 'block';
            
            const percentage = Math.round((score / currentQuiz.total_questions) * 100);
            document.getElementById('scoreCircle').textContent = `${score}/${currentQuiz.total_questions}`;
            
            let message;
            if (percentage >= 90) {
                message = 'Outstanding! You mastered this topic! 🎉';
            } else if (percentage >= 70) {
                message = 'Great job! You have a solid understanding! 👍';
            } else if (percentage >= 50) {
                message = 'Good effort! Keep studying to improve! 📚';
            } else {
                message = 'Keep learning! Practice makes perfect! 💪';
            }
            
            document.getElementById('scoreText').textContent = message;
        }

        function startNewQuiz() {
            document.getElementById('resultsPage').style.display = 'none';
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('topicInput').value = '';
        }

        function retakeQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;
            
            document.getElementById('resultsPage').style.display = 'none';
            document.getElementById('quizPage').classList.add('show');
            showQuestion();
        }

        // Initialize event listeners immediately (script is at bottom of page)
        const topicInput = document.getElementById('topicInput');
        const generateBtn = document.getElementById('generateBtn');
        
        console.log('Elements found:', { topicInput, generateBtn }); // Debug log
        
        if (topicInput) {
            // Handle Enter key
            topicInput.addEventListener('keypress', function(e) {
                console.log('Key pressed:', e.key); // Debug log
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    console.log('Enter pressed, calling generateQuiz'); // Debug log
                    generateQuiz();
                }
            });
            
            // Auto-resize textarea
            topicInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 60) + 'px';
            });
        }
        
        if (generateBtn) {
            // Handle arrow button click
            generateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Button clicked, calling generateQuiz'); // Debug log
                generateQuiz();
            });
        }

    </script>
</body>
</html>
